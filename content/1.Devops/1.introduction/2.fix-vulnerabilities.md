---
title: "Step2 漏洞修复"
description: "修复服务器的漏洞"
---

# Fix Vulnerabilities

在 Step1 中，我们对服务器进行了初始化的操作，以为万事具备了吗？不是的，在服务器漏洞扫描中，我们会发现服务器是存在着低版本软件的漏洞的，这就需要我们对这些漏洞进行升级以防止被黑客工具。（毕竟知己知彼，方能百战不殆）

这就需要我们去进行软件的版本升级，使用最新的稳定发行版，值得注意的是，我们需要升级的是长期维护的软件版本，而不是最新的版本，毕竟是面向生产的服务器，这是值得重视的一部分，但是由于使用的服务器的发行版的不一样，我们需要升级的内容也是不一样的。

在 CentOS 7.9 的版本中，我们需要升级的是 CMake 和 OpenSSL，需要将它们升级到稳定的最新的长期维护发行版，而在 OpenEuler-LTS 中，我们仅仅需要安装 CMake 即可，需要注意的是，有些软件是依赖于旧版本而存在的，所以注意不要随便的卸载旧版本，这一点会在文档中指出。

接下来，就让我们开始连接进去服务器，来进行软件的版本升级吧。

## 安装升级 OpenSSL 到最新版本

接下来升级 OpenSSL 版本到 OpenSSL 1.1.1*

第一步需要安装依赖：

```bash
yum -y install perl
```

接着需要下载源码并进行解压，很多的软件并不是使用 `yum` 进行安装的，而是使用编译安装，在卸载的时候仅仅需要将整个安装目录进行删除即可。

```bash
cd /usr/local/src
wget https://github.com/openssl/openssl/releases/download/OpenSSL_1_1_1t/openssl-1.1.1t.tar.gz
tar -zxvf openssl-1.1.1t.tar.gz
```

接着我们进行编译安装，同时会对每一步进行说明。

```bash
cd /usr/local/src/openssl-1.1.1t
./config --prefix=/usr/local/openssl1.1 no-zlib
make && make install
```

`--prefix` 表示我们将 openssl 所安装到的目录，类似于 Windows 系统中的 C 盘或者 D 盘，这里我们将目录设置为[软件名+版本号]，为以后在使用时提供了明确的版本信息。

`no-zlib` 表示我们不使用 zlib 压缩功能，可选的选项有 `zlib`，`zlib-dynamic`，分别表示为使用静态 zlib 压缩库，使用动态 zlib 压缩库。

在编译完成之后，我们需要配置环境变量保证其他软件安装时可以读取到这一版本。

```bash
mv /usr/bin/openssl /usr/bin/openssl.bak
mv /usr/include/openssl /usr/include/openssl.bak

ln -s /usr/local/openssl1.1/bin/openssl /usr/bin/openssl
ln -s /usr/local/openssl1.1/include/openssl /usr/include/openssl
ln -s /usr/local/openssl1.1/lib/libssl.so.1.1 /usr/local/lib64/libssl.so
```

同时将动态链接库添加到系统变量中

```bash
# 查看配置文件是否已添加路径
cat /etc/ld.so.conf

# 如果没有则添加（多次添加会重复）
echo '/usr/local/openssl1.1/lib' >> /etc/ld.so.conf

# 更新配置
ldconfig -v
```

接下来，我们将执行每个软件安装完成后都必须执行的一步，即软件版本查看

```bash
openssl version

# 输出如下内容
OpenSSL 1.1.1t  7 Feb 2023
```

如果成功输出类似的结果，则代表我们安装成功。

当然啦，不同于 Windows 安装软件，可能在安装的时候存在各种各样的问题，接下来会提供一些常见问题的解决办法，

第一个可能出现的问题时缺少 `libssl.so.3` 文件：

```bash
openssl:error while loading shared libraries: libssl.so.3: cannot open shared object file: No such file or directory
```