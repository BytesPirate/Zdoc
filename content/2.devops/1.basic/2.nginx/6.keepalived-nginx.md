---
title: "Step6 基于 Keepalived 的高可用"
description: "基于 Keepalived 的高可用"
---

## 为什么需要高可用

在日常提供服务时，理想状态下，服务器说不会出现问题的，但是这是不可能的，会遭遇很多情况，比如服务器硬件的损坏，停电等情况的发生，在我们只有一台服务器的情况下，我们可以选择停机修复，但是如果一旦是不能停机的服务呢，对于企业的损失是巨大的。

这就需要我们实现服务器的高可用情况，对于没有本身提供高可用的软件来说，使用 keepalived 第三方软件，可以实现高可用，同样的方式适用于 HAProxy， Mysql， MinIO等服务的高可用。

## 环境准备

高可用意味着我们不会存在一台服务器，所以基本需求就是两台服务器，并且确保这两台服务器已经安装完成了 [Keepalived](/devops/middleware/keepalived/install) 和 [Nginx](install) 服务，具体的操作可以观看有关部分的安装文档，并且这两台服务器在同一个子网的网段下。

### 配置 Master 节点

首先需要创建 Nginx 的检测脚本，用于检测 Nginx 服务是否正常运行。

```shell
#!/bin/bash

# 若 nginx 进程不存在，则停止 keepalived 服务
A=`ps -C nginx --no-header | wc -l` #查看nginx进程数
if [ $A -eq 0 ];then
    systemctl start nginx
    if [ `ps -C nginx --no-header | wc -l` -eq 0 ];then
        systemctl stop keepalived
    fi
fi
```